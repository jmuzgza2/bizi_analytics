<!DOCTYPE html>
<html>
<head>
    <title>Bizi Zaragoza - Lista</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">ðŸš² Bizi Analytics</a>
            <div class="navbar-nav">
                <a class="nav-link active" href="{% url 'lista_estaciones' %}">Lista</a>
                <a class="nav-link" href="{% url 'mapa_estaciones' %}">Mapa</a> </div>
        </div>
    </nav>
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">ðŸš² Pulso de la Ciudad (Total de bicis aparcadas)</h5>
        </div>
        <div class="card-body">
            <canvas id="graficoGlobal" height="60"></canvas>
        </div>
    </div>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="input-group input-group-lg">
                    <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                    <input type="text" id="buscador" class="form-control" placeholder="Buscar estaciÃ³n por nombre o nÃºmero...">
                </div>
            </div>
        </div>

        <h1>Estaciones Bizi</h1>
        
        <div class="list-group mt-3" id="lista-estaciones">
            {% for estacion in estaciones %}
            <a href="{% url 'detalle_estacion' estacion.id_externo %}" 
               class="item-estacion ist-group-item list-group-item-action d-flex justify-content-between align-items-center item-estacion"
               data-search="{{ estacion.id_externo }} {{ estacion.nombre|lower }}">
                
                <div>
                    <span class="badge bg-secondary me-2">{{ estacion.id_externo }}</span>
                    {{ estacion.nombre }}
                </div>
                <i class="bi bi-chevron-right text-muted"></i>
            </a>
            {% endfor %}
        </div>
    </div>

    <script>
        document.getElementById('buscador').addEventListener('keyup', function(e) {
            // 1. Convertimos lo que escribe el usuario a minÃºsculas
            const termino = e.target.value.toLowerCase();
            
            // 2. Seleccionamos todos los elementos de la lista
            const items = document.querySelectorAll('.item-estacion');

            items.forEach(item => {
                // 3. Obtenemos TODO el texto visible dentro del botÃ³n (Nombre + ID)
                const textoVisible = item.textContent.toLowerCase();
                
                // 4. Comprobamos si coincide
                if (textoVisible.includes(termino)) {
                    item.classList.remove('d-none'); // Bootstrap: mostrar
                } else {
                    item.classList.add('d-none');    // Bootstrap: ocultar
                }
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<script>
    const ctxGlobal = document.getElementById('graficoGlobal').getContext('2d');
    const datosCiudad = JSON.parse('{{ datos_globales|escapejs }}');

    new Chart(ctxGlobal, {
        type: 'line',
        data: {
            datasets: [{
                label: 'Bicis disponibles en todo Zaragoza',
                data: datosCiudad,
                borderColor: '#6610f2', // Morado
                backgroundColor: 'rgba(102, 16, 242, 0.1)',
                fill: true,
                tension: 0.3,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    type: 'time',
                    time: { unit: 'hour', displayFormats: { hour: 'HH:mm' } }
                },
                y: {
                    title: { display: true, text: 'Total Bicis' }
                }
            }
        }
    });
</script>
</body>
</html>